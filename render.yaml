# ════════════════════════════════════════════════════════════════════════════
#  Scanctum — Render Blueprint (free tier)
#  Deploy: Dashboard → New → Blueprint → select repo → Deploy Blueprint
#  Note: Background workers (Celery) are NOT available on free plan. Scans will
#  queue but not run until you add a worker on a paid plan — see DEPLOY.md.
# ════════════════════════════════════════════════════════════════════════════

databases:
  - name: scanctum-db
    databaseName: scanctum
    user: scanctum
    plan: free
    region: oregon
    postgresMajorVersion: "16"

services:
  - type: redis
    name: scanctum-redis
    region: oregon
    plan: free
    maxmemoryPolicy: allkeys-lru
    ipAllowList: []

  - type: web
    name: scanctum-backend
    region: oregon
    plan: free
    runtime: docker
    rootDir: backend
    dockerfilePath: Dockerfile
    dockerContext: .
    dockerCommand: ./entrypoint-render.sh
    healthCheckPath: /health
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: scanctum-db
          property: connectionString
      - key: DATABASE_URL_SYNC
        fromDatabase:
          name: scanctum-db
          property: connectionString
      - key: REDIS_URL
        fromService:
          name: scanctum-redis
          type: redis
          property: connectionString
      - key: JWT_SECRET_KEY
        generateValue: true
      - key: JWT_ALGORITHM
        value: HS256
      - key: JWT_EXPIRE_MINUTES
        value: "480"
      - key: BACKEND_CORS_ORIGINS
        value: '["https://scanctum-frontend.onrender.com"]'
      - key: API_V1_PREFIX
        value: /api/v1
      - key: SCANNER_MAX_DEPTH_QUICK
        value: "3"
      - key: SCANNER_MAX_PAGES_QUICK
        value: "40"
      - key: SCANNER_MAX_DEPTH_FULL
        value: "6"
      - key: SCANNER_MAX_PAGES_FULL
        value: "250"
      - key: SCANNER_REQUEST_DELAY
        value: "2.0"
      - key: SCANNER_CONCURRENCY
        value: "5"

  # Celery worker omitted: not available on free plan. Add manually on paid plan — see DEPLOY.md.

  - type: web
    name: scanctum-frontend
    region: oregon
    plan: free
    runtime: docker
    rootDir: frontend
    dockerfilePath: Dockerfile
    dockerContext: .
    envVars:
      - key: NEXT_PUBLIC_API_URL
        value: https://scanctum-backend.onrender.com/api/v1
